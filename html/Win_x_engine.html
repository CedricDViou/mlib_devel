<!-- start content -->
			<p><b>Block:</b> Windowed X-Engine (<code>win_x_engine</code>)<br />
<b>Block Author</b>: Jason Manley, Aaron Parsons, Terry Filiba<br />
<b>Document Author</b>: Jason Manley<br />
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Summary"><span class="tocnumber">1</span> <span class="toctext">Summary</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Mask_Parameters"><span class="tocnumber">2</span> <span class="toctext">Mask Parameters</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Ports"><span class="tocnumber">3</span> <span class="toctext">Ports</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Description"><span class="tocnumber">4</span> <span class="toctext">Description</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Introduction"><span class="tocnumber">4.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Input_format"><span class="tocnumber">4.2</span> <span class="toctext">Input format</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Output_Format"><span class="tocnumber">4.3</span> <span class="toctext">Output Format</span></a></li>
</ul>
</li>
</ul>
</td></tr></table><script>if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
<h2> <span class="mw-headline" id="Summary"> Summary </span></h2>
<p>CASPER X engine with added internal valid data masking functionality. Based on Aaron Parsons' design.
</p>
<h2> <span class="mw-headline" id="Mask_Parameters"> Mask Parameters </span></h2>
<table width="500" border="1" cellpadding="3">
<tr>
<th> Parameter
</th><th> Variable
</th><th> Description
</th></tr>
<tr>
<td> Number of antennas
</td><td> n_ants
</td><td> Number of antennas to process.
</td></tr>
<tr>
<td> Bit width of samples in
</td><td> n_bits
</td><td> Bit width of each input sample number. Usually set to 4, resulting in 16 bit input numbers (2 polarizations, complex numbers).
</td></tr>
<tr>
<td> Accumulation length
</td><td> acc_len
</td><td> Specified per antenna.
</td></tr>
<tr>
<td> Adder latency
</td><td> add_latency
</td><td> Used to set the latency of internal adders.
</td></tr>
<tr>
<td> Multiplier latency
</td><td> mult_latency
</td><td> Used to set the latency of internal multipliers.
</td></tr>
<tr>
<td> BRAM latency
</td><td> bram_latency
</td><td> Used to set the latency of internal BRAMs.
</td></tr>
<tr>
<td> Implementation: Multiplier type
</td><td> use_ded_mult
</td><td> Select the type of multipliers to use. Can be a single number or array - see below.
</td></tr>
<tr>
<td> Implementation: Delay type
</td><td> use_bram_delay
</td><td> Selects the type of delays to implement. Single number configures all internal taps.
</td></tr>
</table>
<h2> <span class="mw-headline" id="Ports"> Ports </span></h2>
<table width="500" border="1" cellpadding="3">
<tr>
<th> Port
</th><th> Dir
</th><th> Data Type
</th><th> Description
</th></tr>
<tr>
<td> ant
</td><td> in
</td><td> variable width. see below.
</td><td> Input port for incoming antenna data.
</td></tr>
<tr>
<td> sync_in
</td><td> in
</td><td> boolean
</td><td> Synchronization pulse. New window begins clock cycle after sync received.
</td></tr>
<tr>
<td> window_valid
</td><td> in
</td><td> boolean
</td><td> Indicates incoming antenna data is valid. Must remain constant for acc_len*n_ants.
</td></tr>
<tr>
<td> acc
</td><td> out
</td><td> variable width. see below.
</td><td> Output data.
</td></tr>
<tr>
<td> valid
</td><td> out
</td><td> boolean
</td><td> Indicates data on acc is valid.
</td></tr>
<tr>
<td> sync_out
</td><td> out
</td><td> boolean
</td><td> Passthrough for sync pulses.
</td></tr>
</table>
<h2> <span class="mw-headline" id="Description"> Description </span></h2>
<h3> <span class="mw-headline" id="Introduction"> Introduction </span></h3>
<p>The CASPER X engine is a streaming architecture block where complex antenna data is input and accumulated products (for all cross-multiplications) are output in conjugated form. Because it is streaming with valid data expected on every clock cycle, data is logically divided into windows. These windows can either be valid (in which case the computation yields valid, outputted results) or invalid (in which case computation still occurs, but the results are ignored and not presented to the user).
</p>
<h3> <span class="mw-headline" id="Input_format"> Input format </span></h3>
<p>Data is input serially: <code>antenna A, antenna B, antenna C</code> etc. Each antenna's data consists of dual polarization, complex data. The bit width of each component number can be set as a parameter, <code>n_bits</code>. The X-engine thus expects these four numbers of <code>n_bits</code> to be concatenated into a single, unsigned number. CASPER convention dictates that complex numbers are represented with higher bits as real and lower bits as imaginary. The top half of the input number is polarization one and the lower half polarization two.
</p><p>The internals of the block are reset with the reception of a sync pulse. A new window begins on the very next clock cycle. Each window is <code>int_len</code><img class="tex" alt="\times" src="images/math/9/e/e/9eedd61e32f7a8e70e171028a7e5dc08.png" /><code>n_ants</code> clock cycles long. The data for each antenna is input for <code>acc_len</code> clock cycles. 
</p><p>For example, for <code>n_bits</code> of 4 and <code>acc_len</code> of 2, the input to the X-engine would be 16 bits every clock cycle mapped as follows:
</p>
<table align="center" border="1" cellpadding="3">
<tr>
<th> ...
</th><th> <span class="texhtml"><i>t</i><sub>4</sub></span>
</th><th> <span class="texhtml"><i>t</i><sub>3</sub></span>
</th><th> <span class="texhtml"><i>t</i><sub>2</sub></span>
</th><th> <span class="texhtml"><i>t</i><sub>1</sub></span>
</th><th> <span class="texhtml"><i>t</i><sub>0</sub></span>
</th><th align="right"> <img class="tex" alt="\rightarrow" src="images/math/8/3/e/83e37b7246fdfcb99b2754210ebeae27.png" />
</th></tr>
<tr>
<td> ...
</td><td> <span class="texhtml"><i>C</i><sub>1<i>r</i><i>e</i><i>a</i><i>l</i></sub></span>
</td><td> <span class="texhtml"><i>B</i><sub>1<i>r</i><i>e</i><i>a</i><i>l</i></sub></span>
</td><td> <span class="texhtml"><i>B</i><sub>1<i>r</i><i>e</i><i>a</i><i>l</i></sub></span>
</td><td> <span class="texhtml"><i>A</i><sub>1<i>r</i><i>e</i><i>a</i><i>l</i></sub></span>
</td><td> <span class="texhtml"><i>A</i><sub>1<i>r</i><i>e</i><i>a</i><i>l</i></sub></span>
</td><td align="right"> most_sig 4b<img class="tex" alt="\rightarrow" src="images/math/8/3/e/83e37b7246fdfcb99b2754210ebeae27.png" />
</td></tr>
<tr>
<td> ...
</td><td> <span class="texhtml"><i>C</i><sub>1<i>i</i><i>m</i><i>a</i><i>g</i></sub></span>
</td><td> <span class="texhtml"><i>B</i><sub>1<i>i</i><i>m</i><i>a</i><i>g</i></sub></span>
</td><td> <span class="texhtml"><i>B</i><sub>1<i>i</i><i>m</i><i>a</i><i>g</i></sub></span>
</td><td> <span class="texhtml"><i>A</i><sub>1<i>i</i><i>m</i><i>a</i><i>g</i></sub></span>
</td><td> <span class="texhtml"><i>A</i><sub>1<i>i</i><i>m</i><i>a</i><i>g</i></sub></span>
</td><td align="right"> 4b<img class="tex" alt="\rightarrow" src="images/math/8/3/e/83e37b7246fdfcb99b2754210ebeae27.png" />
</td></tr>
<tr>
<td> ...
</td><td> <span class="texhtml"><i>C</i><sub>2<i>r</i><i>e</i><i>a</i><i>l</i></sub></span>
</td><td> <span class="texhtml"><i>B</i><sub>2<i>r</i><i>e</i><i>a</i><i>l</i></sub></span>
</td><td> <span class="texhtml"><i>B</i><sub>2<i>r</i><i>e</i><i>a</i><i>l</i></sub></span>
</td><td> <span class="texhtml"><i>A</i><sub>2<i>r</i><i>e</i><i>a</i><i>l</i></sub></span>
</td><td> <span class="texhtml"><i>A</i><sub>2<i>r</i><i>e</i><i>a</i><i>l</i></sub></span>
</td><td align="right"> 4b<img class="tex" alt="\rightarrow" src="images/math/8/3/e/83e37b7246fdfcb99b2754210ebeae27.png" />
</td></tr>
<tr>
<td> ...
</td><td> <span class="texhtml"><i>C</i><sub>2<i>i</i><i>m</i><i>a</i><i>g</i></sub></span>
</td><td> <span class="texhtml"><i>B</i><sub>2<i>i</i><i>m</i><i>a</i><i>g</i></sub></span>
</td><td> <span class="texhtml"><i>B</i><sub>2<i>i</i><i>m</i><i>a</i><i>g</i></sub></span>
</td><td> <span class="texhtml"><i>A</i><sub>2<i>i</i><i>m</i><i>a</i><i>g</i></sub></span>
</td><td> <span class="texhtml"><i>A</i><sub>2<i>i</i><i>m</i><i>a</i><i>g</i></sub></span>
</td><td align="right"> least_sig 4b<img class="tex" alt="\rightarrow" src="images/math/8/3/e/83e37b7246fdfcb99b2754210ebeae27.png" />
</td></tr>
<caption style="caption-side: bottom"> X-engine input with <code>acc_len</code> of 2.
</caption></table>
<p>The <code>window_valid</code> line is expected to remain constant for the duration of each window. If it is high, the output is considered valid and captured into the output FIFO buffer. With the close of that window, the output will be presented to the user as valid data on every second clock pulse. If <code>window_valid</code> was held low, the data is ignored.
</p><p>With the close of one window, anther begins directly afterwards. Data can thus be streamed in and out continuously, while a sync pulse will force the start of a new window.
</p>
<h3> <span class="mw-headline" id="Output_Format"> Output Format </span></h3>
<p>The windowed X-engine will produce <img class="tex" alt="num_baselines = n_ants \times \tfrac{n_ants + 1}{2}" src="images/math/e/6/a/e6a9c3a9cb7fd7d3aba5a8fa1162cd8b.png" /> valid outputs. The unwindowed x engine produces  <img class="tex" alt="num_baselines = n_ants \times (\tfrac{n_ants}{2} + 1)" src="images/math/d/0/7/d07f2e115b966b9e0f53e61366aa1f24.png" /> results. The extra valids are a result of the algorithm employed and are masked out by the internal <code>x_engine_mask</code>.
</p><p>Generally, the output of the X-engine configured for <code>N</code> antennas can be mapped into a table with <img class="tex" alt="\tfrac{n_ants}{2} + 1" src="images/math/d/5/b/d5bd5f3304d3f314d8e71517b106cdb0.png" /> columns and <span class="texhtml"><i>N</i></span> rows as follows:
</p>
<table align="center" border="1" cellpadding="3">
<tr>
<td> <span class="texhtml">1<sup><i>s</i><i>t</i></sup></span>
</td><td> <img class="tex" alt="0 \times 0" src="images/math/f/e/f/fefdc61fe92015ae636bdd0c66dbdcca.png" />
</td><td> <img class="tex" alt="0 \times N" src="images/math/8/6/e/86ec141e0130ccdc5e5c822adf372b61.png" />
</td><td> <img class="tex" alt="0 \times (N-1)" src="images/math/9/a/d/9ad9fe25a149d43ff7811432992f5741.png" />
</td><td> <img class="tex" alt="0 \times (N-2)" src="images/math/9/5/6/956dc43049615cf5fb088df32deb63eb.png" />
</td><td> <span class="texhtml">...</span>
</td><td> <img class="tex" alt="\rightarrow" src="images/math/8/3/e/83e37b7246fdfcb99b2754210ebeae27.png" />
</td></tr>
<tr>
<td> <span class="texhtml">2<sup><i>n</i><i>d</i></sup></span>
</td><td> <img class="tex" alt="1 \times 1" src="images/math/b/9/9/b99a31f00d8eff828fb2b1657efe2f4b.png" />
</td><td> <img class="tex" alt="0 \times 1" src="images/math/0/9/0/090c4c54de93ee8a6284f6a14e3f1ff8.png" />
</td><td> <img class="tex" alt="1 \times N" src="images/math/a/4/8/a48c766b7d3907922863031c5140af8b.png" />
</td><td> <img class="tex" alt="1 \times (N-1)" src="images/math/2/9/a/29ad5974796023a3c8f37742da0c4ab1.png" />
</td><td> <span class="texhtml">...</span>
</td><td> <img class="tex" alt="\rightarrow" src="images/math/8/3/e/83e37b7246fdfcb99b2754210ebeae27.png" />
</td></tr>
<tr>
<td> <span class="texhtml">3<sup><i>r</i><i>d</i></sup></span>
</td><td> <img class="tex" alt="2 \times 2" src="images/math/8/6/0/8608c2f6f82c35cf210f370f7885f1d0.png" />
</td><td> <img class="tex" alt="1 \times 2" src="images/math/5/c/4/5c4af06825f0bf58453d1eb5005998b0.png" />
</td><td> <img class="tex" alt="0 \times 2" src="images/math/c/6/c/c6cca0f1467030b6e47525417efcf620.png" />
</td><td> <img class="tex" alt="2 \times N" src="images/math/b/d/3/bd3a4b6ea9613dcbbe5ca2d26475de04.png" />
</td><td> <span class="texhtml">...</span>
</td><td> <img class="tex" alt="\rightarrow" src="images/math/8/3/e/83e37b7246fdfcb99b2754210ebeae27.png" />
</td></tr>
<tr>
<td> <span class="texhtml">4<sup><i>t</i><i>h</i></sup></span>
</td><td> <img class="tex" alt="3 \times 3" src="images/math/b/a/0/ba0dffbf721ff09756465187f3aca372.png" />
</td><td> <img class="tex" alt="2 \times 3" src="images/math/4/b/3/4b3a89ff7af9ad06700897f831201197.png" />
</td><td> <img class="tex" alt="1 \times 3" src="images/math/1/6/1/16139cf011eac898b0ed1febfef1aef2.png" />
</td><td> <img class="tex" alt="0 \times 3" src="images/math/f/8/f/f8fe0f2b0f1d799e2ef5a29fcb5eabd6.png" />
</td><td> <span class="texhtml">...</span>
</td><td> <img class="tex" alt="\rightarrow" src="images/math/8/3/e/83e37b7246fdfcb99b2754210ebeae27.png" />
</td></tr>
<tr>
<td> <span class="texhtml">5<sup><i>t</i><i>h</i></sup></span>
</td><td> <img class="tex" alt="4 \times 4" src="images/math/a/9/0/a90d73338b85d85b864d2b3471cd0415.png" />
</td><td> <img class="tex" alt="3 \times 4" src="images/math/5/3/a/53ac77a4c5ab7f8cd1fc7a85054f963d.png" />
</td><td> <img class="tex" alt="2 \times 4" src="images/math/9/d/6/9d6e3211a06f45c6081c446445b442a7.png" />
</td><td> <img class="tex" alt="1 \times 4" src="images/math/4/d/e/4de712fdca923440c6a9d279b639c9d1.png" />
</td><td> <span class="texhtml">...</span>
</td><td> <img class="tex" alt="\rightarrow" src="images/math/8/3/e/83e37b7246fdfcb99b2754210ebeae27.png" />
</td></tr>
<tr>
<td> <span class="texhtml">6<sup><i>t</i><i>h</i></sup></span>
</td><td> <img class="tex" alt="5 \times 5" src="images/math/b/7/9/b79d1e8f94d827235f4cf90df5742f7a.png" />
</td><td> <img class="tex" alt="4 \times 5" src="images/math/b/c/5/bc5707de42d06f11c5ea7516037d1998.png" />
</td><td> <img class="tex" alt="3 \times 5" src="images/math/d/0/4/d046e60f303b58b31d39db348bfa4863.png" />
</td><td> <img class="tex" alt="2 \times 5" src="images/math/2/f/2/2f20c082285fd61f1d8e663b53050973.png" />
</td><td> <span class="texhtml">...</span>
</td><td> <img class="tex" alt="\rightarrow" src="images/math/8/3/e/83e37b7246fdfcb99b2754210ebeae27.png" />
</td></tr>
<tr>
<td> <span class="texhtml">...</span>
</td><td> <span class="texhtml">...</span>
</td><td> <span class="texhtml">...</span>
</td><td> <span class="texhtml">...</span>
</td><td> <span class="texhtml">...</span>
</td><td> <span class="texhtml">...</span>
</td><td> <img class="tex" alt="\rightarrow" src="images/math/8/3/e/83e37b7246fdfcb99b2754210ebeae27.png" />
</td></tr>
<caption style="caption-side: bottom"> Each table entry represents a valid output. Data is read out right to left, top to bottom. Bracketed values are from previous window.
</caption></table>
<p>As an example, consider the output for a 4 antenna system (with antennas numbered A through D):
</p>
<table align="center" border="1" cellpadding="3">
<tr>
<td> 1st
</td><td> <b>AA</b>
</td><td> prev win DA
</td><td> prev win CA
</td></tr>
<tr>
<td> 2nd
</td><td> <b>BB</b>
</td><td> <b>AB</b>
</td><td> prev win BD
</td></tr>
<tr>
<td> 3rd
</td><td> <b>CC</b>
</td><td> <b>BC</b>
</td><td> <b>AC</b>
</td></tr>
<tr>
<td> 4th
</td><td> next win AA
</td><td> <b>CD</b>
</td><td> <b>BD</b>
</td></tr>
<tr>
<td> 5th
</td><td> next win BB
</td><td> next win AB
</td><td> <b>DB</b>
</td></tr>
<caption style="caption-side: bottom"> Boldfaced type represents current valid window of data. Data is read out right to left, top to bottom. Non-boldfaced data is masked.
</caption></table>
<p>Thanks to the inclusion of the <code>x_engine_mask</code> block, X-engine output duplicates (observed in rows 5 and 6 above) are automatically removed. The output of a 4 antenna windowed X-engine is thus <code>AA, AB, BB, AC, BC, CC, BD, CD, DD, DA</code>.
</p>