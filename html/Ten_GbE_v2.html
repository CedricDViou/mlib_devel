<!-- start content -->
			<p><b>Block:</b> 10GbE Transceiver Mark II (<code>ten_GbE_v2</code>)<br />
<b>Block Author</b>: David George<br />
<b>Document Author</b>: David George<br />
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Summary"><span class="tocnumber">1</span> <span class="toctext">Summary</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Mask_Parameters"><span class="tocnumber">2</span> <span class="toctext">Mask Parameters</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Ports"><span class="tocnumber">3</span> <span class="toctext">Ports</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Description"><span class="tocnumber">4</span> <span class="toctext">Description</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Configuration"><span class="tocnumber">4.1</span> <span class="toctext">Configuration</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Transmitting"><span class="tocnumber">4.2</span> <span class="toctext">Transmitting</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Receiving"><span class="tocnumber">4.3</span> <span class="toctext">Receiving</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Addressing"><span class="tocnumber">4.4</span> <span class="toctext">Addressing</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#LED_Outputs"><span class="tocnumber">4.5</span> <span class="toctext">LED Outputs</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Operation"><span class="tocnumber">4.6</span> <span class="toctext">Operation</span></a></li>
</ul>
</li>
</ul>
</td></tr></table><script>if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
<h2> <span class="mw-headline" id="Summary"> Summary </span></h2>
<p>This block sends and receives UDP frames (packets). It accepts a 64 bit wide data stream with user-determined frame breaks. The data stream is wrapped in a UDP frame for transmission. Incoming UDP packets are unwrapped and the data presented as a 64 bit wide stream. 
</p>
<h2> <span class="mw-headline" id="Mask_Parameters"> Mask Parameters </span></h2>
<table width="500" border="1" cellpadding="3">
<tr>
<th> Parameter
</th><th> Variable
</th><th> Description
</th></tr>
<tr>
<td> Port
</td><td> port
</td><td> Selects the physical CX4 port.
</td></tr>
<tr>
<td> Shallow RX Fifo
</td><td> rx_dist_ram
</td><td> Selects shallow distributed RAM rather than BRAM for the RX FIFO. This option should only be used if the application clock is faster than 156.25 MHz. Constant overruns will most likely occur for clock frequency lower than this.
</td></tr>
<tr>
<td> Pre-emphasis
</td><td> pre_emph
</td><td> Selects the default pre-emaphasis to use over the physical link. Currently unused.
</td></tr>
<tr>
<td> Differential Swing
</td><td> swing
</td><td> Selects the size of the differential swing to use in mV. Currently unused.
</td></tr>
<tr>
<td> Enable Fabric on Startup
</td><td> fab_en
</td><td> This will enable the 10Ge interface on start-up, negating the requirement of software intervention.
</td></tr>
<tr>
<td> Fabric MAC Addresss
</td><td> fab_mac
</td><td> Sets the default MAC, usually configured by software.
</td></tr>
<tr>
<td> Fabric IP Addresss
</td><td> fab_ip
</td><td> Sets the default IP, usually configured by software.
</td></tr>
<tr>
<td> Fabric UDP Port
</td><td> fab_port
</td><td> Sets the default UDP Port, usually configured by software.
</td></tr>
<tr>
<td> Fabric Gateway
</td><td> fab_gate
</td><td> Sets the default gateway address, usually configured by software.
</td></tr>
<tr>
<td> Enable CPU RX
</td><td> cpu_rx_en
</td><td> Optionally disable the CPU receive interface to save 2 BRAMS, if that interface is not required.
</td></tr>
<tr>
<td> Enable CPU TX
</td><td> cpu_tx_en
</td><td> Optionally disable the CPU trasmit interface to save 2 BRAMS, if that interface is not required.
</td></tr>
</table>
<h2> <span class="mw-headline" id="Ports"> Ports </span></h2>
<table width="500" border="1" cellpadding="3">
<tr>
<th> Port
</th><th> Dir
</th><th> Data Type
</th><th> Description
</th></tr>
<tr>
<td> rst
</td><td> in
</td><td> boolean
</td><td> Resets the transmit and receive memories when asserted
</td></tr>
<tr>
<td> tx_data
</td><td> in
</td><td> UFix_64_0
</td><td> The data stream to be transmitted
</td></tr>
<tr>
<td> tx_valid
</td><td> in
</td><td> boolean
</td><td> The core accepts the data on <code>tx_data</code> into the buffer while this line is high
</td></tr>
<tr>
<td> tx_dest_ip
</td><td> in
</td><td> UFix_32_0
</td><td> Selects the IP address of the receiving device
</td></tr>
<tr>
<td> tx_dest_port
</td><td> in
</td><td> UFix_16_0
</td><td> Selects the listening port of the receiving device (UDP port)
</td></tr>
<tr>
<td> tx_end_of_frame
</td><td> in
</td><td> boolean
</td><td> Signals the transceiver to begin transmitting the buffered frame (ie signals end of the frame). This signal must pulse high on the same clock cycle as the final tx_valid signal
</td></tr>
<tr>
<td> rx_ack
</td><td> in
</td><td> boolean
</td><td> Used to acknowledge reception of the data currently on rx_data and signals the transceiver to produce the next 64 bits from the receiver FIFO.
</td></tr>
<tr>
<td> rx_overrun_ack
</td><td> in
</td><td> boolean
</td><td> Used to reset the RX state machine when a RX overrun occurs.
</td></tr>
<tr>
<td> led_up
</td><td> out
</td><td> boolean
</td><td> Indicates a link on the port
</td></tr>
<tr>
<td> led_rx
</td><td> out
</td><td> boolean
</td><td> Represents received traffic on the port
</td></tr>
<tr>
<td> led_tx
</td><td> out
</td><td> boolean
</td><td> Represents transmitted traffic on the port
</td></tr>
<tr>
<td> tx_afull
</td><td> out
</td><td> boolean
</td><td> Indicates that the TX FIFO is almost full
</td></tr>
<tr>
<td> tx_overflow
</td><td> out
</td><td> boolean
</td><td> Indicates that the TX FIFO has overflowed
</td></tr>
<tr>
<td> rx_data
</td><td> out
</td><td> UFix_64_0
</td><td> The received data stream.
</td></tr>
<tr>
<td> rx_valid
</td><td> out
</td><td> boolean
</td><td> Indicates that the data on rx_data is valid (indicates a packet, or partial packet is in the RX buffer).
</td></tr>
<tr>
<td> rx_source_ip
</td><td> out
</td><td> UFix_32_0
</td><td> Represents the IP address of the sender of the current packet.
</td></tr>
<tr>
<td> rx_source_port
</td><td> out
</td><td> UFix_16_0
</td><td> Represents the sender's UDP port of the current packet.
</td></tr>
<tr>
<td> rx_end_of_frame
</td><td> out
</td><td> boolean
</td><td> Goes high to indicate the end of the received frame.
</td></tr>
<tr>
<td> rx_bad_frame
</td><td> out
</td><td> UFix_16_0
</td><td> Indicates a CRC error on the frame immediately received when asserted simultaneously with <code>rx_end_of_frame</code>.
</td></tr>
<tr>
<td> rx_overrun
</td><td> out
</td><td> UFix_16_0
</td><td> Indicates that an RX buffer overrun when asserted simultaneously with <code>rx_end_of_frame</code>.
</td></tr>
</table>
<h2> <span class="mw-headline" id="Description"> Description </span></h2>
<p>This document is a draft and requires verification.
</p>
<h3> <span class="mw-headline" id="Configuration"> Configuration </span></h3>
<p>This core will typically be configured by software by setting the following OPB registers: MAC, IP, UDP port, ARP table, gateway and fabric enable. However, there are currently parameters to set these values (except for the ARP table) at build time.
</p>
<h3> <span class="mw-headline" id="Transmitting"> Transmitting </span></h3>
<p>To transmit, data is clocked into the TX buffer through <code>tx_data</code> in 64 bit wide words using <code>tx_valid</code>. When sending the final word of data in the packet, simultaneously pulse the <code>tx_end_of_frame</code> line; the transceiver will add a UDP wrapper addressed to <code>tx_dest_ip:tx_dest_port</code> and begin transmission immediately. Note that tx_dest_ip and tx_dest_port are only looked at when tx_end_of_frame is pulsed high, thus the value must be valid for that clock period but is irrelevant otherwise.
</p><p>The transmit FIFO can only handle frame sizes of up to 8704 bytes, or 1088 64 bit words. As the TX FIFO approaches full, the <code>tx_afull</code> signal will be asserted. This is an indication that the application should stop entering data into the core. If the application overflows the TX buffer, the <code>tx_overflow</code> signal will be asserted. When the overflow is asserted the TX interface will block, requiring a reset (using <code>rst</code>) to return to full functionality.
</p>
<h3> <span class="mw-headline" id="Receiving"> Receiving </span></h3>
<p>Upon receipt of a packet, <code>rx_valid</code> will go high, with the received data presented on <code>rx_data</code> in 64 bit wide words. You acknowledge receipt of this data using <code>rx_ack</code>, at which point the next data word will be presented. When the end of the packet is reached, <code>rx_end_of_frame</code> will go high. If the a CRC error occurred when receiving the packet, the <code>rx_bad_frame</code> signal will be asserted.
</p><p>If the RX data overran the RX FIFO, the <code>rx_overrun</code> signal will be asserted along with <code>rx_end_of_frame</code>. When this occurs the RX state machine will block until the <code>rx_overrun_ack</code> is asserted. It is recommended that the <code>rx_overrun</code> be directly connected to the <code>rx_overrun_ack</code> signal.
</p><p>There is no hard maximum frame size for RX. However, care must be taken not to overrun the rx buffer.
</p>
<h3> <span class="mw-headline" id="Addressing"> Addressing </span></h3>
<p>To transmit, the IPv4 address is represented as a 32 bit binary number (whereas it's usually represented as four 8 bit decimal numbers). For example, if you wanted to send all packets to <code>192.168.1.1</code>, you would enter  
</p><p><img class="tex" alt="192\times2^{24} + 168\times2^{16} + 1\times2^8 + 1 = 3 232 235 777" src="images/math/a/8/b/a8b112b568f18c6898a2566faf26aa43.png" />
</p><p>as the IP address. The port is represented by a 16 bit number, allowing full addressing of the UDP port range. Ports below 1024 are generally reserved for Linux kernel and Internet functions. Ports 1024 - 49151 are registered for specific applications and may not be used without IANA registration. To ensure inter-operability and compatibility, we recommend using dynamic (private) ports 49152 through 65535.
</p>
<h3> <span class="mw-headline" id="LED_Outputs"> LED Outputs </span></h3>
<p>The LED lines indicate port activity and can be connected to external GPIO LED interfaces. Bear in mind that even if no packets are being transmitted or received through the Simulink interface block, miscellaneous configuration packets are still sent and may be received by the microprocessor core. This activity will also be reflected on the activity LEDs.
</p>
<h3> <span class="mw-headline" id="Operation"> Operation </span></h3>
<p>Apart from configuring the block, the processor is also used to map the routing tables. ARP requests and responses are handled by the CPU.
</p>